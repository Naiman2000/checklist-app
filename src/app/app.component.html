<div [ngClass]="{ dark: isDarkMode }" class="container">
  <div class="header">
    <h2>Checklist</h2>
    <button id="modeToggleBtn" (click)="toggleDarkMode()">
      {{ isDarkMode ? 'â˜€ï¸ Light Mode' : 'ğŸŒ™ Dark Mode' }}
    </button>
  </div>

  <div class="section-border">
    <div class="tabs">
      <button
        *ngFor="let cat of categories"
        (click)="switchCategory(cat)"
        [class.active]="cat === currentCategory"
      >
        {{ cat }}
      </button>
    </div>

    <hr class="task-section-divider" />
    <div class="input-group" style="display: flex; gap: 0.5rem;">
      <input placeholder="Add a new task" disabled style="flex: 1" />
      <button id="addBtn" (click)="showModal()">Add</button>
    </div>

    <!-- Select All Checkbox and Delete All Trash BELOW -->
    <div style="margin: 0.5rem 0; display: flex; flex-direction: column; align-items: flex-start;">
      <div style="display: flex; align-items: center;">
        <input
          type="checkbox"
          id="selectAll"
          #selectAllBox
          [checked]="allSelected()"
          (change)="toggleSelectAll(selectAllBox.checked)"
        />
        <label for="selectAll" style="margin-left: 0.5rem;">Select All</label>
      </div>
      <span 
        class="trash"
        [ngStyle]="{
          'margin-top': '0.75rem',
          'margin-left': '0.25rem',
          'cursor': 'pointer',
          'font-size': '1.2rem',
          'color': allSelected() ? 'red' : 'var(--text)'
        }"
        [class.disabled]="!allSelected()"
        (click)="deleteAllSelectedTasks()"
        [title]="allSelected() ? 'Delete all selected tasks' : 'Select all to enable delete'"
      >
      ğŸ—‘ï¸
      </span>
    </div>

    <hr class="task-section-divider" />

    <ul id="taskList">
      <li
        *ngFor="let task of filteredTasks(); let i = index"
        [class.completed]="task.done"
        style="display: flex; align-items: flex-start;"
      >

      <!--Task Checkbox-->
      <input 
        type="checkbox"
        [checked]="selectedTasks.has(task.id || '')"
        (change)="toggleTaskSelection(task.id || '')"
        style="margin-right: 0.5rem; margin-top: 0.5rem"
        />

        <div style="flex: 1;">
          <span (click)="toggleTask(i)" 
                [class.completed]="task.done"
                >{{ task.name }}
                  <small *ngIf="currentCategory === 'All'" style="margin-left: 0.5rem; color: gray; font-weight: normal; font-size: 0.85rem;">
                  ({{ task.category }})
                  </small>
          </span>

          <span *ngIf="(isDueToday(task.deadline) || isOverdue(task.deadline)) && !task.reminderDismissed && !task.done" style="margin-left:8px;">
            <img src="assets/bell.png" class="bell-icon" title="Task is due/overdue!" width="22" height="22" />
            <button class="dismiss-btn" (click)="dismissReminder(task)">Dismiss</button>
          </span>

          <button
            (click)="showModal(i)" 
            style="cursor: pointer; background: none; border: none; color: #007bff; font-size: 1rem;"
          >
            âœï¸ Edit
          </button>

          <div *ngIf="task.deadline">
            <span
              class="deadline"
              [ngClass]="{
                overdue: isOverdue(task.deadline),
                'due-today': isDueToday(task.deadline)
              }"
            >
              Due: {{ task.deadline }}
            </span>
          </div>

          <div class="description">{{ task.description || '' }}</div>
        </div>

        <span class="trash" (click)="deleteTask(i)">ğŸ—‘ï¸</span>
      </li>
    </ul>

    <div class="modal" [ngStyle]="{ display: isModalOpen ? 'flex' : 'none' }"> 
      <div class="modal-content">
        <h3 style="text-align: center;">
          {{ editTaskIndex !== null ? 'Edit Task' : 'New Task' }}
        </h3>

        <input
          type="text"
          id="modalTaskInput"
          placeholder="Enter task title..."
          maxlength="37"
          [(ngModel)]="modalTask.name"
        />

        <textarea
          id="modalDescription"
          placeholder="Optional description (max 180 words)..."
          maxlength="190"
          [(ngModel)]="modalTask.description"
        ></textarea>

        <div style="margin-top: 0.5rem;">
          <label for="modalDeadline">Deadline:</label>
          <input
            type="date"
            id="modalDeadline"
            [(ngModel)]="modalTask.deadline"
          />

          <button (click)="closeModal()">Cancel</button>
          <button 
            (click)="submitTask()"
            [ngStyle]="{
              'background-color': (modalTask.name.trim() && modalTask.deadline) ? '#000' : '#ccc',
              'color': (modalTask.name.trim() && modalTask.deadline) ? '#fff' : '#888',
              'cursor': (modalTask.name.trim() && modalTask.deadline) ? 'pointer' : 'not-allowed'
             }"
          > 
            {{ editTaskIndex !== null ? 'Save' : 'Add' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
