<div [ngClass]="{ dark: isDarkMode }" class="container">
  <div class="header">
    <h2>Checklist</h2>
    <button id="modeToggleBtn" (click)="toggleDarkMode()">
      {{ isDarkMode ? '☀️ Light Mode' : '🌙 Dark Mode' }}
    </button>
  </div>

  <div class="section-border">
    <div class="tabs">
      <button
        *ngFor="let cat of categories"
        (click)="switchCategory(cat)"
        [class.active]="cat === currentCategory"
      >
        {{ cat }}
      </button>
    </div>

    <hr class="task-section-divider" />

    <div class="input-group" style="display: flex; gap: 0.5rem;">
      <input placeholder="Add a new task" disabled style="flex: 1" />
      <button id="addBtn" (click)="showModal()">Add</button>
    </div>

    <hr class="task-section-divider" />

    <ul id="taskList">
      <li
        *ngFor="let task of filteredTasks(); let i = index"
        [class.completed]="task.done"
      >
        <div style="flex: 1;">
          <span (click)="toggleTask(i)" class="task-name">{{ task.name }}</span>

          <button
            (click)="showModal(i)"
            style="cursor: pointer; background: none; border: none; color: #007bff; font-size: 1rem;"
          >
            ✏️ Edit
          </button>

          <div *ngIf="task.deadline">
            <span
              class="deadline"
              [ngClass]="{
                overdue: isOverdue(task.deadline),
                'due-today': isDueToday(task.deadline)
              }"
            >
              Due: {{ task.deadline }}
            </span>
          </div>

          <div class="description">{{ task.description || '' }}</div>
        </div>

        <span class="trash" (click)="deleteTask(i)">🗑️</span>
      </li>
    </ul>

    <!-- Modal -->
    <div class="modal" [ngStyle]="{ display: isModalOpen ? 'flex' : 'none' }">
      <div class="modal-content">
        <h3 style="text-align: center;">
          {{ editTaskIndex !== null ? 'Edit Task' : 'New Task' }}
        </h3>

        <input
          type="text"
          id="modalTaskInput"
          placeholder="Enter task title..."
          maxlength="37"
          [(ngModel)]="modalTask.name"
        />

        <textarea
          id="modalDescription"
          placeholder="Optional description (max 180 words)..."
          maxlength="190"
          [(ngModel)]="modalTask.description"
        ></textarea>

        <div style="margin-top: 0.5rem;">
          <label for="modalDeadline">Deadline:</label>
          <input
            type="date"
            id="modalDeadline"
            [(ngModel)]="modalTask.deadline"
          />

          <button (click)="closeModal()">Cancel</button>
          <button (click)="submitTask()">
            {{ editTaskIndex !== null ? 'Save' : 'Add' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
